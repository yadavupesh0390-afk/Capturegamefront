<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>बाजार साथी • Login</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif;}
body{
  min-height:100vh;
  background:radial-gradient(circle at top,#000,#0a0a0a,#111);
  display:flex;justify-content:center;
  padding:50px 0;color:#fff;
}
.container{
  width:90%;max-width:500px;
  background:rgba(0,0,0,.55);
  padding:35px;border-radius:20px;
  box-shadow:0 0 35px #00eaff33;
}
h1{text-align:center;font-size:34px;font-weight:800;margin-bottom:25px;}
.nav-buttons{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:25px;}
.nav-buttons button{
  padding:14px 20px;border:none;border-radius:14px;
  cursor:pointer;font-weight:700;color:#fff;
  background:#000000aa;border:1px solid #ffffff22;
}
.tabs{display:flex;margin-bottom:15px;}
.tab{width:50%;padding:12px;text-align:center;}
.tab.active{background:#00eaff33;}
form{display:none;}
form.active{display:block;}
input{
  width:100%;padding:12px;margin:10px 0;
  border-radius:12px;background:#00000088;color:#fff;border:1px solid #444;
}
button.submit{
  width:100%;padding:14px;margin-top:15px;
  background:#00eaff;color:#000;
  border:none;border-radius:14px;font-size:18px;font-weight:700;
}
</style>
</head>

<body>

<div class="container">
<h1>बाजार साथी</h1>

<div class="nav-buttons">
  <button onclick="showPanel('wholesaler')"><i class="fas fa-store"></i> Wholesaler</button>
  <button onclick="showPanel('retailer')"><i class="fas fa-cart-shopping"></i> Retailer</button>
  <button onclick="showPanel('delivery')"><i class="fas fa-motorcycle"></i> Delivery</button>
</div>

<!-- WHOLESALER -->
<div id="wholesaler" class="panel">
  <div class="tabs">
    <div class="tab active">Login</div>
  </div>
  <form id="wholesaler-login" class="active">
    <input placeholder="Mobile Number">
    <input type="password" placeholder="Password">
    <button class="submit" type="button">Login</button>
  </form>
</div>

<!-- RETAILER -->
<div id="retailer" class="panel" style="display:none;">
  <div class="tabs"><div class="tab active">Login</div></div>
  <form id="retailer-login" class="active">
    <input placeholder="Mobile Number">
    <input type="password" placeholder="Password">
    <button class="submit" type="button">Login</button>
  </form>
</div>

<!-- DELIVERY -->
<div id="delivery" class="panel" style="display:none;">
  <div class="tabs"><div class="tab active">Login</div></div>
  <form id="delivery-login" class="active">
    <input placeholder="Mobile Number">
    <input type="password" placeholder="Password">
    <button class="submit" type="button">Login</button>
  </form>
</div>

</div>

<script type="module">
/* ================= AUTO LOGIN ================= */
const token = localStorage.getItem("token");
const role  = localStorage.getItem("role");
if(token && role){
  window.location.href = role + ".html";
}

/* ================= UI ================= */
window.showPanel = id=>{
  document.querySelectorAll('.panel').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
}
showPanel('wholesaler');

/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging.js";

const firebaseConfig = {
  apiKey: "AIzaSyBioiLSE3HyZh49yJv93MwnQFrmAm6wJ5g",
  authDomain: "shop-ab586.firebaseapp.com",
  projectId: "shop-ab586",
  messagingSenderId: "603669325846",
  appId: "1:603669325846:web:00f3ccff7fa977bf542d37"
};

const app = initializeApp(firebaseConfig);
const messaging = getMessaging(app);
const VAPID_KEY = "BFcKfbosO2sXWogZ5fBBt31vEkw_1iwgQWVrZjAJ90pXdhdFBSbXM_Oppuoxm-QIidekMzIQdcl3XrJy0ltkC8s";

/* ================= SERVER ================= */
const SERVER_URL = "https://shopbacked-vmhs.onrender.com";

/* ================= LOGIN ================= */
async function loginUser(role,mobile,password){
  const res = await fetch(`${SERVER_URL}/api/login`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({mobile,password,role})
  });
  const json = await res.json();
  if(!json.success) return alert(json.message);

  localStorage.setItem("token",json.token);
  localStorage.setItem("userId",json.userId);
  localStorage.setItem("role",role);

  try{
    const permission = await Notification.requestPermission();
    if(permission==="granted"){
      const fcmToken = await getToken(messaging,{vapidKey:VAPID_KEY});
      if(fcmToken){
        await fetch(`${SERVER_URL}/api/notifications/saveToken`,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({userId:json.userId,fcmToken})
        });
      }
    }
  }catch(e){}

  window.location.href = role + ".html";
}

/* ================= HANDLERS ================= */
['wholesaler','retailer','delivery'].forEach(role=>{
  document.querySelector(`#${role}-login .submit`).onclick=()=>{
    const i=document.querySelectorAll(`#${role}-login input`);
    loginUser(role,i[0].value,i[1].value);
  };
});
</script>

</body>
</html>
