<!DOCTYPE html>  <html lang="en">  
<head>  
<meta charset="UTF-8">  
<title>Retailer Dashboard</title>  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">  
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">  <style>  
*{box-sizing:border-box;font-family:Poppins,sans-serif}  
body{margin:0;background:#f3f6fb}  
.main{padding:20px}  
  
.icon-bar{  
 display:flex;gap:20px;justify-content:center;  
 background:#064e3b;padding:12px;border-radius:14px;  
 max-width:600px;margin:auto  
}  
.icon-btn{  
 background:#16a34a;color:#fff;border:none;  
 width:55px;height:55px;border-radius:50%;  
 font-size:22px;cursor:pointer  
}  
  
.header{  
 margin-top:15px;background:#fff;padding:15px;  
 border-radius:12px;text-align:center;  
 box-shadow:0 5px 15px rgba(0,0,0,.08)  
}  
  
.products-grid{  
 display:grid;  
 grid-template-columns:repeat(3,1fr);  
 gap:10px;margin-top:20px;  
 max-height:70vh;overflow-y:auto  
}  
.product-card{  
 background:#fff;padding:5px;border-radius:10px;  
 text-align:center;cursor:pointer;  
 box-shadow:0 3px 8px rgba(0,0,0,.08)  
}  
.product-card img{  
 width:100%;height:80px;object-fit:cover;border-radius:8px  
}  
.product-card h4{font-size:12px;margin:5px 0}  
.price{font-size:12px;color:#16a34a;font-weight:600}  
  
.modal{  
 position:fixed;inset:0;  
 background:rgba(0,0,0,.5);  
 display:none;align-items:center;justify-content:center;  
 z-index:20  
}  
.modal-content{  
 background:#fff;padding:20px;  
 width:90%;max-width:500px;  
 border-radius:15px;max-height:85vh;overflow:auto;  
 position:relative  
}  
  
.close-btn,.buy-btn{  
 position:absolute;top:10px;  
 width:34px;height:34px;border-radius:50%;  
 display:flex;align-items:center;justify-content:center;  
 color:#fff;cursor:pointer  
}  
.close-btn{right:10px;background:#ef4444}  
.buy-btn{right:55px;background:#2563eb}  
  
input{  
 width:100%;padding:10px;margin:8px 0;  
 border-radius:8px;border:1px solid #ccc  
}  
button.primary{  
 background:#16a34a;color:#fff;border:none;  
 padding:10px 15px;border-radius:10px;cursor:pointer  
}  
  
img.full{width:100%;border-radius:10px;margin:10px 0}  
  
.order-status{  
 background:#f8fafc;padding:10px;border-radius:10px;margin-top:10px  
}  
.step{  
 font-size:12px;color:#999;margin:2px 0  
}  
.step.active{  
 color:#16a34a;font-weight:600  
}  
</style>  </head>  <body>  
<div class="main">  <div class="icon-bar">  
 <button class="icon-btn" onclick="loadProducts()"><i class="bi bi-search"></i></button>  
 <button class="icon-btn" onclick="openOrders()"><i class="bi bi-bag-check"></i></button>  
</div>  <div class="header">  
 <h3>Retailer Dashboard</h3>  
</div>  <div class="header">  
 <input id="wid" placeholder="Enter Wholesaler ID (eg: W001)">  
 <button class="primary" onclick="loadProducts()">Search</button>  
</div>  <div class="products-grid" id="products"></div>  </div>  <!-- DETAIL -->  <div class="modal" id="detailModal">  
<div class="modal-content">  
 <div class="close-btn" onclick="closeAll()">✕</div>  
 <div class="buy-btn" onclick="openPayment()"><i class="bi bi-cart-plus"></i></div>   <h3 id="dName"></h3>  
 <img id="dImg" class="full">  
 <p id="dPrice" class="price"></p>  
 <p id="dDetail"></p>   <hr>  
 <p><b>Shop:</b> <span id="dShop"></span></p>  
 <p><b>Address:</b> <span id="dAddress"></span></p>  
 <p><b>Mobile / UPI:</b> <span id="dMobile"></span></p>  
</div>  
</div>  <!-- PAYMENT -->  <div class="modal" id="payModal">  
<div class="modal-content">  
 <h3>Payment & Proof</h3>   <p><b>Shop:</b> <span id="pShop"></span></p>  
 <p><b>UPI / Mobile:</b> <span id="pMobile"></span></p>   <img id="pImg" class="full">   <input id="rName" placeholder="Retailer Name">  
 <input id="rMobile" placeholder="Retailer Mobile">  
 <input id="txn" placeholder="Transaction ID">  
 <input id="proof" type="file" accept="image/*">  <button type="button" class="primary" onclick="submitOrder()">Submit Order</button>
<button type="button" onclick="closeAll()">Cancel</button>

</div>  
</div>  <!-- MY ORDERS MODAL -->  <div class="modal" id="ordersModal">  
<div class="modal-content">  
 <div class="close-btn" onclick="closeAll()">✕</div>  
 <h3>My Orders</h3>  
 <div id="myOrders"></div>  
</div>  
</div>  <script>  
let selectedProduct=null;  
  
function loadProducts(){  
 let list=JSON.parse(localStorage.getItem("products")||"[]")  
  .filter(p=>p.wid===wid.value);  
  
 products.innerHTML=list.map((p,i)=>`  
  <div class="product-card" onclick="showDetail(${i})">  
   <img src="${p.img}">  
   <h4>${p.name}</h4>  
   <div class="price">₹${p.price}</div>  
  </div>  
 `).join("") || "No products found";  
}  
  
function showDetail(i){  
 let WID = wid.value.trim();  
 let all = JSON.parse(localStorage.getItem("products")||"[]");  
 let list = all.filter(p=>p.wid===WID);  
 let p = list[i];  
  
 let profile = JSON.parse(  
   localStorage.getItem("wholesalerProfile_"+WID) || "{}"  
 );  
  
 selectedProduct = {  
   ...p,  
   shop: p.shopName || profile.shopName || "N/A",  
   mobile: p.mobile || profile.mobile || "N/A",  
   address: p.address || profile.address || "N/A"  
 };  
  
 dName.innerText=p.name;  
 dImg.src=p.img;  
 dPrice.innerText="₹"+p.price;  
 dDetail.innerText=p.detail;  
  
 dShop.innerText=selectedProduct.shop;  
 dMobile.innerText=selectedProduct.mobile;  
 dAddress.innerText=selectedProduct.address;  
  
 detailModal.style.display="flex";  
}  
  
function openPayment(){  
 pShop.innerText=selectedProduct.shop;  
 pMobile.innerText=selectedProduct.mobile;  
 pImg.src=selectedProduct.img;  
 payModal.style.display="flex";  
}  
  
function submitOrder(){  
 let name=document.getElementById("rName").value;  
 let mobile=document.getElementById("rMobile").value;  
 let txnId=document.getElementById("txn").value;  
 let proof=document.getElementById("proof").files[0];  
  
 if(!name||!mobile||!txnId||!proof){  
  alert("All fields required");  
  return;  
 }  
  
 let reader=new FileReader();  
 reader.onload=function(){  
  let orders=JSON.parse(localStorage.getItem("orders")||"[]");  
  let orderId=Date.now();  
  
  orders.push({  
   orderId: orderId,  
   wid:selectedProduct.wid,  
   product:selectedProduct.name,  
   price:selectedProduct.price,  
   productImg:selectedProduct.img,  
   retailerName:name,  
   retailerMobile:mobile,  
   txnId:txnId,  
   proofImg:reader.result,  
   status:"pending",  
   statusTime:Date.now()  
  });  
  
  localStorage.setItem("orders",JSON.stringify(orders));  
  alert("Order sent successfully ✅");  
  closeAll();  
};  
  
 reader.readAsDataURL(proof);  
}  
  
function closeAll(){  
 document.querySelectorAll(".modal").forEach(m=>m.style.display="none");  
}  
  
// ===== MY ORDERS =====  
function openOrders(){  
 document.getElementById("ordersModal").style.display="flex";  
 displayMyOrders();  
}  
  
function displayMyOrders(){  
 let all=JSON.parse(localStorage.getItem("orders")||"[]");  
 let rMobile=document.getElementById("rMobile").value;  
 let myOrders=all.filter(o=>o.retailerMobile===rMobile);  
  
 // Remove delivered orders older than 10 min  
 let now=Date.now();  
 myOrders=myOrders=myOrders.filter(o=>{  
   if(o.status==="delivered" && now - o.statusTime > 600000) return false;  
   return true;  
 });  
  
 let myOrdersDiv=document.getElementById("myOrders");  
 myOrdersDiv.innerHTML=myOrders.map(o=>`  
   <div class="order-status">  
     <b>${o.product}</b> (₹${o.price})<br>  
     <div class="step ${o.status==='pending'?'active':''}">● PENDING</div>  
     <div class="step ${o.status==='confirmed'?'active':''}">● CONFIRMED</div>  
     <div class="step ${o.status==='pickup'?'active':''}">● PICKUP</div>  
     <div class="step ${o.status==='delivered'?'active':''}">● DELIVERED</div>  
   </div>  
 `).join('') || "No orders";  
  
 localStorage.setItem("orders",JSON.stringify(all));  
}  
  
setInterval(()=>{  
 if(document.getElementById("ordersModal").style.display==="flex"){  
   displayMyOrders();  
 }  
},30000);  
</script>  </body>  
</html>  